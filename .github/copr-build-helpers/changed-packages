#! /bin/bash -x

# Call detect-changed-packages script, and generate the JSON needed by the
# GitHub Action's "task output mechanism".
# See .github/workflows/copr-builds.yml

echo -n "{"
echo -n '"package": ['
separator=""

dump_package_name() {
    echo -n "$separator\"$1\""
    separator=", "
}

git fetch origin main

./releng/detect-changed-packages | \
while read -r package; do
    dump_package_name "$package"
done
echo "]}"
