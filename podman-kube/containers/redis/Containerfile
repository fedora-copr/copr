FROM copr-base:latest

LABEL description="Redis/Valkey server for COPR"

RUN --mount=type=cache,target=/var/cache/dnf \
    dnf -y install redis && \
    dnf clean all

RUN mkdir -p /data && chown valkey:valkey /data

USER valkey
EXPOSE 6379
HEALTHCHECK --interval=10s --timeout=5s --start-period=10s \
    CMD redis-cli ping | grep -q PONG || exit 1

ENTRYPOINT []
CMD ["redis-server", "--protected-mode", "no", "--dir", "/data"]
